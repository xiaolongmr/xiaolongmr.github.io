<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾åºŠä¸Šä¼ å·¥å…· - ç²˜è´´ä¸Šä¼ è‡³CloudFlareå›¾åºŠ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            width: 280px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #1a2980;
        }

        .feature-title {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: #1a2980;
        }

        .feature-desc {
            color: #555;
            line-height: 1.6;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin: 40px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #1a2980;
            text-align: center;
        }

        .upload-area {
            border: 3px dashed #1a2980;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: rgba(26, 41, 128, 0.05);
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .upload-area:hover {
            background: rgba(26, 41, 128, 0.1);
        }

        .upload-icon {
            font-size: 5rem;
            color: #1a2980;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #333;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
            box-shadow: 0 4px 15px rgba(26, 41, 128, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #1a2980;
            border: 2px solid #1a2980;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(26, 41, 128, 0.4);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .config-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .config-item {
            background: rgba(26, 41, 128, 0.05);
            padding: 20px;
            border-radius: 10px;
        }

        .config-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #1a2980;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-value {
            font-size: 1.1rem;
            color: #333;
            word-break: break-all;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            font-size: 0.9rem;
        }

        /* é€šçŸ¥æ ·å¼ */
        .img-upload-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            z-index: 9999;
            max-width: 300px;
            font-size: 14px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateX(20px);
        }

        .img-upload-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .img-upload-success {
            background-color: #4caf50;
            color: white;
        }

        .img-upload-error {
            background-color: #f44336;
            color: white;
        }

        .img-upload-info {
            background-color: #2196F3;
            color: white;
        }

        .img-upload-close {
            float: right;
            margin-left: 10px;
            cursor: pointer;
            opacity: 0.8;
        }

        .img-upload-close:hover {
            opacity: 1;
        }

        /* æ‹–æ‹½åŒºåŸŸæ ·å¼ */
        .img-upload-dropzone {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(33, 150, 243, 0.2);
            border: 3px dashed #2196F3;
            z-index: 9998;
            box-sizing: border-box;
        }

        .img-upload-dropzone.active {
            display: block;
        }

        .img-upload-dropzone-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px 40px;
            border-radius: 8px;
            font-size: 18px;
            color: #2196F3;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .features {
                flex-direction: column;
                align-items: center;
            }

            .feature-card {
                width: 100%;
            }

            .button-group {
                flex-direction: column;
            }

            h1 {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>å›¾åºŠä¸Šä¼ å·¥å…·</h1>
            <p class="subtitle">ç²˜è´´æˆ–æ‹–æ‹½å›¾ç‰‡ä¸Šä¼ è‡³CloudFlareå›¾åºŠï¼Œè‡ªåŠ¨ç”ŸæˆMarkdownæ ¼å¼çš„å›¾ç‰‡é“¾æ¥ï¼Œæé«˜å†…å®¹åˆ›ä½œæ•ˆç‡</p>
        </header>

        <div class="features">
            <div class="feature-card">
                <div class="feature-icon">ğŸ“‹</div>
                <h3 class="feature-title">ç²˜è´´ä¸Šä¼ </h3>
                <p class="feature-desc">åœ¨ä»»ä½•è¾“å…¥æ¡†ä¸­ç²˜è´´å›¾ç‰‡ï¼Œè‡ªåŠ¨ä¸Šä¼ è‡³å›¾åºŠå¹¶æ’å…¥Markdowné“¾æ¥</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">ğŸ–¼ï¸</div>
                <h3 class="feature-title">æ‹–æ‹½ä¸Šä¼ </h3>
                <p class="feature-desc">å°†å›¾ç‰‡æ–‡ä»¶æ‹–æ‹½åˆ°è¾“å…¥æ¡†åŒºåŸŸï¼Œè‡ªåŠ¨å®Œæˆä¸Šä¼ è¿‡ç¨‹</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">âš™ï¸</div>
                <h3 class="feature-title">è‡ªå®šä¹‰é…ç½®</h3>
                <p class="feature-desc">è®¾ç½®æœåŠ¡å™¨åœ°å€ã€è®¤è¯ç ã€ä¸Šä¼ å‚æ•°ç­‰ä¸ªæ€§åŒ–é€‰é¡¹</p>
            </div>
        </div>

        <div class="upload-section">
            <h2 class="section-title">å¼€å§‹ä½¿ç”¨å›¾åºŠä¸Šä¼ å·¥å…·</h2>

            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">â¬†ï¸</div>
                <p class="upload-text">ç²˜è´´å›¾ç‰‡(Ctrl+V)æˆ–æ‹–æ‹½å›¾ç‰‡æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p>
                <p><small>æ”¯æŒJPG, PNG, GIF, WebPæ ¼å¼ï¼Œæœ€å¤§æ–‡ä»¶5MB</small></p>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="configBtn">
                    <span>âš™ï¸</span> é…ç½®å›¾åºŠå‚æ•°
                </button>
                <button class="btn btn-secondary" id="usageBtn">
                    <span>â“</span> ä½¿ç”¨è¯´æ˜
                </button>
            </div>
        </div>

        <div class="config-section">
            <h2 class="section-title">å½“å‰é…ç½®</h2>
            <div class="config-grid" id="currentConfig">
                <!-- é…ç½®ä¿¡æ¯å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <footer>
            <p>å›¾åºŠä¸Šä¼ å·¥å…· v0.4.1 | é€‚é… CloudFlare-ImgBed | MIT License</p>
            <p>æç¤ºï¼šæ­¤å·¥å…·éœ€è¦å›¾åºŠæœåŠ¡å™¨æ”¯æŒï¼Œè¯·ç¡®ä¿é…ç½®æ­£ç¡®çš„æœåŠ¡å™¨åœ°å€å’Œè®¤è¯ç </p>
        </footer>
    </div>

    <!-- æ‹–æ‹½åŒºåŸŸ -->
    <div class="img-upload-dropzone" id="dropZone">
        <div class="img-upload-dropzone-message">é‡Šæ”¾é¼ æ ‡ä¸Šä¼ å›¾ç‰‡</div>
    </div>

    <script>
        // å›¾ç‰‡ä¸Šä¼ å·¥å…·æ ¸å¿ƒé€»è¾‘
        (function () {
            'use strict';

            // é˜²æ­¢é‡å¤æ³¨å…¥
            if (window.imageUploaderInitialized) {
                return;
            }
            window.imageUploaderInitialized = true;

            // é»˜è®¤é…ç½®ä¿¡æ¯
            const DEFAULT_CONFIG = {
                AUTH_CODE: 'z-l.top',
                SERVER_URL: 'https://img.z-l.top',
                UPLOAD_PARAMS: {
                    serverCompress: true,
                    uploadChannel: 'telegram',
                    autoRetry: true,
                    uploadNameType: 'short',
                    returnFormat: 'full',
                    uploadFolder: 'img/test'
                },
                NOTIFICATION_DURATION: 3000,
                MARKDOWN_TEMPLATE: '![{filename}]({url})',
                AUTO_COPY_URL: false,
                ALLOWED_HOSTS: ['*'],
                MAX_FILE_SIZE: 5 * 1024 * 1024
            };

            // ä»localStorageè·å–ç”¨æˆ·é…ç½®
            function getConfig() {
                const savedConfig = localStorage.getItem('imageUploaderConfig');
                if (savedConfig) {
                    try {
                        return JSON.parse(savedConfig);
                    } catch (e) {
                        console.error('Error parsing saved config', e);
                    }
                }
                return { ...DEFAULT_CONFIG };
            }

            // ä¿å­˜é…ç½®åˆ°localStorage
            function saveConfig(config) {
                localStorage.setItem('imageUploaderConfig', JSON.stringify(config));
            }

            // å½“å‰é…ç½®
            let CONFIG = getConfig();

            // æ˜¾ç¤ºé€šçŸ¥çš„å‡½æ•°
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `img-upload-notification img-upload-${type}`;

                const closeBtn = document.createElement('span');
                closeBtn.className = 'img-upload-close';
                closeBtn.textContent = 'âœ•';
                closeBtn.onclick = () => removeNotification(notification);

                const messageSpan = document.createElement('span');
                messageSpan.textContent = message;

                notification.appendChild(closeBtn);
                notification.appendChild(messageSpan);
                document.body.appendChild(notification);

                // æ·»åŠ æ˜¾ç¤ºåŠ¨ç”»
                setTimeout(() => notification.classList.add('show'), 10);

                // è‡ªåŠ¨æ¶ˆå¤±
                const timeout = setTimeout(() => removeNotification(notification), CONFIG.NOTIFICATION_DURATION);

                // é¼ æ ‡æ‚¬åœæ—¶æš‚åœæ¶ˆå¤±
                notification.addEventListener('mouseenter', () => clearTimeout(timeout));
                notification.addEventListener('mouseleave', () => setTimeout(() => removeNotification(notification), 1000));
            }

            // ç§»é™¤é€šçŸ¥
            function removeNotification(notification) {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }

            // å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿
            function copyToClipboard(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showNotification('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                } catch (err) {
                    showNotification('å¤åˆ¶å¤±è´¥ï¼š' + err.message, 'error');
                }
                document.body.removeChild(textarea);
            }

            // æ£€æŸ¥æ–‡ä»¶å¤§å°
            function checkFileSize(file) {
                if (file.size > CONFIG.MAX_FILE_SIZE) {
                    showNotification(`æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆ${Math.round(CONFIG.MAX_FILE_SIZE / 1024 / 1024)}MBï¼‰`, 'error');
                    return false;
                }
                return true;
            }

            // ä¸Šä¼ å›¾ç‰‡
            async function uploadImage(blob, targetElement) {
                const formData = new FormData();
                const filename = `pasted-image-${Date.now()}.png`;
                formData.append('file', blob, filename);

                const queryParams = new URLSearchParams({
                    authCode: CONFIG.AUTH_CODE,
                    ...CONFIG.UPLOAD_PARAMS
                }).toString();

                try {
                    showNotification('æ­£åœ¨ä¸Šä¼ å›¾ç‰‡ï¼Œè¯·ç¨å€™...', 'info');

                    const response = await fetch(`${CONFIG.SERVER_URL}/upload?${queryParams}`, {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();

                        if (result && result.length > 0) {
                            const imageUrl = result[0].src;
                            insertMarkdownImage(imageUrl, targetElement, filename);
                            showNotification('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼', 'success');

                            if (CONFIG.AUTO_COPY_URL) {
                                copyToClipboard(imageUrl);
                            }
                        } else {
                            showNotification('ä¸Šä¼ æˆåŠŸä½†æœªè·å–åˆ°å›¾ç‰‡é“¾æ¥', 'error');
                        }
                    } else {
                        let errorMsg = 'ä¸Šä¼ å¤±è´¥';
                        try {
                            const errorResponse = await response.json();
                            errorMsg += 'ï¼š' + (errorResponse.message || response.statusText);
                        } catch (e) {
                            errorMsg += `ï¼ˆçŠ¶æ€ç ï¼š${response.status}ï¼‰`;
                        }
                        showNotification(errorMsg, 'error');
                    }
                } catch (error) {
                    showNotification(`ä¸Šä¼ è¿‡ç¨‹å‘ç”Ÿé”™è¯¯ï¼š${error.message}`, 'error');
                }
            }

            // åœ¨è¾“å…¥æ¡†ä¸­æ’å…¥ Markdown æ ¼å¼çš„å›¾ç‰‡é“¾æ¥
            function insertMarkdownImage(imageUrl, element, filename) {
                const markdownImage = CONFIG.MARKDOWN_TEMPLATE
                    .replace('{url}', imageUrl)
                    .replace('{filename}', filename.replace(/\.[^/.]+$/, ''));

                // å¯¹äºæ¼”ç¤ºé¡µé¢ï¼Œæˆ‘ä»¬ç›´æ¥æ˜¾ç¤ºç»“æœ
                if (element.id === 'uploadArea') {
                    const resultDiv = document.createElement('div');
                    resultDiv.style.marginTop = '20px';
                    resultDiv.style.padding = '15px';
                    resultDiv.style.background = '#f0f8ff';
                    resultDiv.style.borderRadius = '8px';
                    resultDiv.style.wordBreak = 'break-all';

                    resultDiv.innerHTML = `
                        <p><strong>ä¸Šä¼ æˆåŠŸï¼ç”Ÿæˆçš„Markdownï¼š</strong></p>
                        <p style="font-family: monospace; background: #f8f8f8; padding: 10px; border-radius: 4px;">${markdownImage}</p>
                        <p><strong>å›¾ç‰‡URLï¼š</strong> <a href="${imageUrl}" target="_blank">${imageUrl}</a></p>
                    `;

                    element.appendChild(resultDiv);
                }
            }

            // åˆ›å»ºé…ç½®ç•Œé¢
            function createConfigModal() {
                const overlay = document.createElement('div');
                overlay.className = 'img-upload-modal-overlay';
                overlay.style.position = 'fixed';
                overlay.style.top = '0';
                overlay.style.left = '0';
                overlay.style.right = '0';
                overlay.style.bottom = '0';
                overlay.style.background = 'rgba(0, 0, 0, 0.5)';
                overlay.style.zIndex = '9999';

                const modal = document.createElement('div');
                modal.className = 'img-upload-modal';
                modal.style.position = 'fixed';
                modal.style.top = '50%';
                modal.style.left = '50%';
                modal.style.transform = 'translate(-50%, -50%)';
                modal.style.background = 'white';
                modal.style.padding = '20px';
                modal.style.borderRadius = '8px';
                modal.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
                modal.style.zIndex = '10000';
                modal.style.maxWidth = '600px';
                modal.style.width = '90%';
                modal.style.maxHeight = '80vh';
                modal.style.overflowY = 'auto';

                const content = `
                    <h2 style="margin: 0 0 20px; color: #333; font-size: 18px;">å›¾åºŠä¸Šä¼ é…ç½®</h2>
                    <form id="img-upload-config-form">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">è®¤è¯ç </label>
                            <input type="text" name="AUTH_CODE" value="${CONFIG.AUTH_CODE}" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
                            <div style="margin-top: 4px; color: #666; font-size: 12px;">ç”¨äºéªŒè¯ä¸Šä¼ è¯·æ±‚çš„å¯†é’¥</div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">æœåŠ¡å™¨åœ°å€</label>
                            <input type="text" name="SERVER_URL" value="${CONFIG.SERVER_URL}" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
                            <div style="margin-top: 4px; color: #666; font-size: 12px;">å›¾åºŠæœåŠ¡å™¨çš„URLåœ°å€</div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">ä¸Šä¼ é€šé“</label>
                            <select name="uploadChannel" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background-color: white;">
                                <option value="cfr2" ${CONFIG.UPLOAD_PARAMS.uploadChannel === 'cfr2' ? 'selected' : ''}>CloudFlare R2</option>
                                <option value="telegram" ${CONFIG.UPLOAD_PARAMS.uploadChannel === 'telegram' ? 'selected' : ''}>Telegram</option>
                            </select>
                            <div style="margin-top: 4px; color: #666; font-size: 12px;">é€‰æ‹©å›¾ç‰‡ä¸Šä¼ çš„å­˜å‚¨é€šé“</div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">æ–‡ä»¶å‘½åæ–¹å¼</label>
                            <select name="uploadNameType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background-color: white;">
                                <option value="default" ${CONFIG.UPLOAD_PARAMS.uploadNameType === 'default' ? 'selected' : ''}>é»˜è®¤ï¼ˆå‰ç¼€_åŸåï¼‰</option>
                                <option value="index" ${CONFIG.UPLOAD_PARAMS.uploadNameType === 'index' ? 'selected' : ''}>ä»…å‰ç¼€</option>
                                <option value="origin" ${CONFIG.UPLOAD_PARAMS.uploadNameType === 'origin' ? 'selected' : ''}>ä»…åŸå</option>
                                <option value="short" ${CONFIG.UPLOAD_PARAMS.uploadNameType === 'short' ? 'selected' : ''}>çŸ­é“¾æ¥</option>
                            </select>
                            <div style="margin-top: 4px; color: #666; font-size: 12px;">é€‰æ‹©ä¸Šä¼ åçš„æ–‡ä»¶å‘½åæ–¹å¼</div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">ä¸Šä¼ ç›®å½•</label>
                            <input type="text" name="uploadFolder" value="${CONFIG.UPLOAD_PARAMS.uploadFolder}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
                            <div style="margin-top: 4px; color: #666; font-size: 12px;">æŒ‡å®šä¸Šä¼ ç›®å½•ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¾‹å¦‚ï¼šimg/test</div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">é€šçŸ¥æ˜¾ç¤ºæ—¶é—´</label>
                            <input type="number" name="NOTIFICATION_DURATION" value="${CONFIG.NOTIFICATION_DURATION}" min="1000" step="500" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
                            <div style="margin-top: 4px; color: #666; font-size: 12px;">é€šçŸ¥æ¶ˆæ¯æ˜¾ç¤ºçš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">Markdownæ¨¡æ¿</label>
                            <input type="text" name="MARKDOWN_TEMPLATE" value="${CONFIG.MARKDOWN_TEMPLATE}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
                            <div style="margin-top: 4px; color: #666; font-size: 12px;">æ”¯æŒ {filename} å’Œ {url} ä¸¤ä¸ªå˜é‡</div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">å…è®¸çš„ç½‘ç«™</label>
                            <input type="text" name="ALLOWED_HOSTS" value="${CONFIG.ALLOWED_HOSTS.join(',')}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
                            <div style="margin-top: 4px; color: #666; font-size: 12px;">è¾“å…¥åŸŸåï¼Œç”¨é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼šexample.com, *.test.comã€‚ä½¿ç”¨ * è¡¨ç¤ºå…è®¸æ‰€æœ‰ç½‘ç«™</div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">æœ€å¤§æ–‡ä»¶å¤§å°</label>
                            <div style="display: flex; align-items: center;">
                                <input type="number" name="MAX_FILE_SIZE" value="${CONFIG.MAX_FILE_SIZE / 1024 / 1024}" min="1" step="1" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px 0 0 4px; font-size: 14px;">
                                <span style="padding: 8px 12px; background: #f5f5f5; border: 1px solid #ddd; border-left: none; border-radius: 0 4px 4px 0; color: #666;">MB</span>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: flex !important; align-items: center; font-weight: normal !important;">
                                <input type="checkbox" name="AUTO_COPY_URL" ${CONFIG.AUTO_COPY_URL ? 'checked' : ''} style="margin-right: 8px;">
                                è‡ªåŠ¨å¤åˆ¶URLåˆ°å‰ªè´´æ¿
                            </label>
                        </div>
                        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                            <button type="button" class="img-upload-button img-upload-button-secondary" id="img-upload-cancel" style="padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background-color 0.2s; background: #e0e0e0; color: #333;">å–æ¶ˆ</button>
                            <button type="button" class="img-upload-button img-upload-button-secondary" id="img-upload-reset" style="padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background-color 0.2s; background: #e0e0e0; color: #333;">é‡ç½®é»˜è®¤å€¼</button>
                            <button type="submit" class="img-upload-button img-upload-button-primary" style="padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background-color 0.2s; background: #2196F3; color: white;">ä¿å­˜</button>
                        </div>
                    </form>
                `;

                modal.innerHTML = content;
                document.body.appendChild(overlay);
                document.body.appendChild(modal);

                // äº‹ä»¶å¤„ç†
                const form = modal.querySelector('#img-upload-config-form');
                const cancelBtn = modal.querySelector('#img-upload-cancel');
                const resetBtn = modal.querySelector('#img-upload-reset');

                function closeModal() {
                    document.body.removeChild(overlay);
                    document.body.removeChild(modal);
                }

                overlay.addEventListener('click', closeModal);
                cancelBtn.addEventListener('click', closeModal);

                resetBtn.addEventListener('click', () => {
                    if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®åˆ°é»˜è®¤å€¼å—ï¼Ÿ')) {
                        CONFIG = { ...DEFAULT_CONFIG };
                        saveConfig({});
                        showNotification('é…ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼ï¼', 'success');
                        updateConfigDisplay();
                        closeModal();
                    }
                });

                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    try {
                        const formData = new FormData(form);
                        const newConfig = {
                            AUTH_CODE: formData.get('AUTH_CODE'),
                            SERVER_URL: formData.get('SERVER_URL'),
                            UPLOAD_PARAMS: {
                                ...DEFAULT_CONFIG.UPLOAD_PARAMS,
                                uploadChannel: formData.get('uploadChannel'),
                                uploadNameType: formData.get('uploadNameType'),
                                uploadFolder: formData.get('uploadFolder')
                            },
                            NOTIFICATION_DURATION: parseInt(formData.get('NOTIFICATION_DURATION')),
                            MARKDOWN_TEMPLATE: formData.get('MARKDOWN_TEMPLATE'),
                            ALLOWED_HOSTS: formData.get('ALLOWED_HOSTS')
                                .split(',')
                                .map(h => h.trim())
                                .filter(h => h),
                            MAX_FILE_SIZE: parseFloat(formData.get('MAX_FILE_SIZE')) * 1024 * 1024,
                            AUTO_COPY_URL: formData.get('AUTO_COPY_URL') === 'on'
                        };

                        CONFIG = newConfig;
                        saveConfig(newConfig);
                        showNotification('é…ç½®å·²æ›´æ–°ï¼', 'success');
                        updateConfigDisplay();
                        closeModal();
                    } catch (error) {
                        showNotification('é…ç½®æ ¼å¼é”™è¯¯ï¼š' + error.message, 'error');
                    }
                });

                // é˜²æ­¢ç‚¹å‡»æ¨¡æ€æ¡†æ—¶å…³é—­
                modal.addEventListener('click', (e) => e.stopPropagation());
            }

            // æ›´æ–°é…ç½®æ˜¾ç¤º
            function updateConfigDisplay() {
                const configContainer = document.getElementById('currentConfig');
                configContainer.innerHTML = '';

                const configData = [
                    { title: 'æœåŠ¡å™¨åœ°å€', value: CONFIG.SERVER_URL },
                    { title: 'è®¤è¯ç ', value: CONFIG.AUTH_CODE },
                    { title: 'ä¸Šä¼ é€šé“', value: CONFIG.UPLOAD_PARAMS.uploadChannel },
                    { title: 'æ–‡ä»¶å‘½åæ–¹å¼', value: CONFIG.UPLOAD_PARAMS.uploadNameType },
                    { title: 'ä¸Šä¼ ç›®å½•', value: CONFIG.UPLOAD_PARAMS.uploadFolder },
                    { title: 'Markdownæ¨¡æ¿', value: CONFIG.MARKDOWN_TEMPLATE },
                    { title: 'å…è®¸çš„ç½‘ç«™', value: CONFIG.ALLOWED_HOSTS.join(', ') },
                    { title: 'æœ€å¤§æ–‡ä»¶å¤§å°', value: `${CONFIG.MAX_FILE_SIZE / 1024 / 1024} MB` },
                    { title: 'è‡ªåŠ¨å¤åˆ¶URL', value: CONFIG.AUTO_COPY_URL ? 'æ˜¯' : 'å¦' }
                ];

                configData.forEach(item => {
                    const configItem = document.createElement('div');
                    configItem.className = 'config-item';
                    configItem.innerHTML = `
                        <div class="config-title">${item.title}</div>
                        <div class="config-value">${item.value}</div>
                    `;
                    configContainer.appendChild(configItem);
                });
            }

            // åˆå§‹åŒ–æ‹–æ‹½åŒºåŸŸ
            function initDropZone() {
                const dropZone = document.getElementById('dropZone');
                let activeElement = null;

                // å¤„ç†æ‹–æ‹½æ–‡ä»¶
                async function handleFiles(files, targetElement) {
                    for (const file of files) {
                        if (file.type.startsWith('image/')) {
                            if (!checkFileSize(file)) {
                                continue;
                            }
                            await uploadImage(file, targetElement);
                        } else {
                            showNotification('åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶', 'error');
                        }
                    }
                }

                // ç›‘å¬æ‹–æ‹½äº‹ä»¶
                document.addEventListener('dragenter', (e) => {
                    e.preventDefault();
                    activeElement = document.activeElement;
                    if (activeElement && ['INPUT', 'TEXTAREA'].includes(activeElement.tagName)) {
                        dropZone.classList.add('active');
                    }
                });

                document.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                document.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    const rect = document.documentElement.getBoundingClientRect();
                    if (e.clientX <= rect.left || e.clientX >= rect.right ||
                        e.clientY <= rect.top || e.clientY >= rect.bottom) {
                        dropZone.classList.remove('active');
                    }
                });

                document.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('active');

                    if (activeElement && ['INPUT', 'TEXTAREA'].includes(activeElement.tagName)) {
                        const files = Array.from(e.dataTransfer.files);
                        await handleFiles(files, activeElement);
                    } else {
                        const files = Array.from(e.dataTransfer.files);
                        await handleFiles(files, document.getElementById('uploadArea'));
                    }
                });
            }

            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
            function initEventListeners() {
                // ç²˜è´´äº‹ä»¶
                document.addEventListener('paste', async function (event) {
                    const items = event.clipboardData.items;
                    let hasImage = false;

                    for (let item of items) {
                        if (item.type.startsWith('image/')) {
                            hasImage = true;
                            event.preventDefault();
                            const blob = item.getAsFile();

                            if (!checkFileSize(blob)) {
                                return;
                            }

                            await uploadImage(blob, document.activeElement || document.getElementById('uploadArea'));
                            break;
                        }
                    }
                });

                // é…ç½®æŒ‰é’®
                document.getElementById('configBtn').addEventListener('click', createConfigModal);

                // ä½¿ç”¨è¯´æ˜æŒ‰é’®
                document.getElementById('usageBtn').addEventListener('click', () => {
                    showNotification('åœ¨è¾“å…¥æ¡†ä¸­ç²˜è´´å›¾ç‰‡æˆ–æ‹–æ‹½å›¾ç‰‡æ–‡ä»¶åˆ°é¡µé¢åŒºåŸŸå³å¯ä¸Šä¼ ', 'info');
                });

                // åˆå§‹åŒ–æ‹–æ‹½åŒºåŸŸ
                initDropZone();

                // åˆå§‹åŒ–é…ç½®æ˜¾ç¤º
                updateConfigDisplay();
            }

            // åˆå§‹åŒ–å‡½æ•°
            function init() {
                initEventListeners();
                showNotification('å›¾åºŠä¸Šä¼ å·¥å…·å·²åŠ è½½ï¼Œè¯·é…ç½®æœåŠ¡å™¨å‚æ•°åä½¿ç”¨', 'info');
            }

            // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>

</html>